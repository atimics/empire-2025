{:source "patrol-boat.txt", :tests [{:line 6, :description "Patrol-boat moves 4 cells per round.", :givens [{:type :map, :target :game-map, :rows ["P~~~~="]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "P", :target "=", :at-next-round true}]} {:line 17, :description "Patrol-boat has 1 hit.", :givens [{:type :map, :target :game-map, :rows ["P~"]}], :whens [], :thens [{:type :unit-prop, :unit "P", :property :hits, :expected 1}]} {:line 25, :description "Patrol-boat sentry mode.", :givens [{:type :map, :target :game-map, :rows ["P~"]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "P", :property :mode, :expected :sentry}]} {:line 36, :description "Patrol-boat attacks enemy and wins.", :givens [{:type :map, :target :game-map, :rows ["Ps"]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :ship}], :thens [{:type :unit-occupies-cell, :unit "P", :target-unit "s", :at-next-round true} {:type :unit-absent, :unit "s"}]} {:line 47, :description "Patrol-boat attacks enemy and loses.", :givens [{:type :map, :target :game-map, :rows ["Ps"]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :lose, :combat-type :ship}], :thens [{:type :unit-unmoved, :unit "s", :at-next-round true} {:type :unit-absent, :unit "P"} {:type :message-contains, :area :turn, :text "Patrol-boat destroyed"}]} {:line 60, :description "Patrol-boat blocked by land.", :givens [{:type :map, :target :game-map, :rows ["P#"]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :ships-cant-drive-on-land, :at-next-step true}]} {:line 71, :description "Patrol-boat blocked by friendly ship.", :givens [{:type :map, :target :game-map, :rows ["PD~"]} {:type :waiting-for-input, :unit "P", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :somethings-in-the-way, :at-next-step true}]} {:line 82, :description "Sentry patrol-boat wakes when enemy is adjacent.", :givens [{:type :map, :target :game-map, :rows ["Ps~"]} {:type :unit-props, :unit "P", :props {:mode :sentry}}], :whens [{:type :start-new-round} {:type :advance-until-waiting, :unit "P"}], :thens [{:type :unit-prop, :unit "P", :property :mode, :expected :awake} {:type :message-contains, :area :attention, :config-key :enemy-spotted}]}]}