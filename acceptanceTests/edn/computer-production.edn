{:source "computer-production.txt", :tests [{:line 6, :description "No-country city produces army when continent has free city.", :givens [{:type :map, :target :game-map, :rows ["X+" "##"]} {:type :map, :target :computer-map, :rows ["X+" "##"]}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :army}]} {:line 20, :description "No-country city produces nothing when no land objective.", :givens [{:type :map, :target :game-map, :rows ["X#" "##"]} {:type :map, :target :computer-map, :rows ["X#" "##"]}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :no-production, :city "X"}]} {:line 34, :description "Country produces army when zero armies.", :givens [{:type :map, :target :game-map, :rows ["X#" "##"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :army}]} {:line 46, :description "Country produces transport at coastal city after 6 armies.", :givens [{:type :map, :target :game-map, :rows ["X~" "t#"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:army-count 6}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :transport}]} {:line 60, :description "Country inland city skips transport, produces army.", :givens [{:type :map, :target :game-map, :rows ["X#~" "##t"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:army-count 6}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :army}]} {:line 74, :description "Country produces patrol-boat when army and transport caps met.", :givens [{:type :map, :target :game-map, :rows ["X~~~" "##t#" "##t#"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :unit-props, :unit "t1", :props {:country-id 1}} {:type :unit-props, :unit "t1", :props {:army-count 5}} {:type :unit-props, :unit "t2", :props {:country-id 1}} {:type :unit-props, :unit "t2", :props {:army-count 5}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :patrol-boat}]} {:line 91, :description "Country produces destroyer when unadopted transport exists.", :givens [{:type :map, :target :game-map, :rows ["X~~~" "##t#" "##t#" "p###"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :unit-props, :unit "t1", :props {:country-id 1}} {:type :unit-props, :unit "t1", :props {:army-count 5}} {:type :unit-props, :unit "t2", :props {:country-id 1}} {:type :unit-props, :unit "t2", :props {:army-count 5}} {:type :unit-props, :unit "p", :props {:patrol-country-id 1}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :destroyer}]} {:line 110, :description "Country produces fighter at inland city when army cap met.", :givens [{:type :map, :target :game-map, :rows ["X#~" "##t"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:country-id 1}} {:type :unit-props, :unit "t", :props {:army-count 10}}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :fighter}]} {:line 124, :description "Existing production is not overwritten.", :givens [{:type :map, :target :game-map, :rows ["X#" "##"]} {:type :cell-props, :coords [0 0], :props {:country-id 1}} {:type :production, :city "X", :item :army}], :whens [{:type :evaluate-production, :city "X"}], :thens [{:type :production, :city "X", :expected :army}]} {:line 137, :description "Computer production does not repeat after spawning.", :givens [{:type :map, :target :game-map, :rows ["~~~" "~X~" "~~~"]} {:type :production, :city "X", :item :army, :remaining-rounds 1}], :whens [{:type :start-new-round}], :thens [{:type :unit-present, :unit "a", :coords [1 1]} {:type :no-production, :city "X"}]}]}