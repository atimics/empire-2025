; Player transport acceptance tests.

; Transport produced at player city is awake with no computer fields.
GIVEN game map
  ~O
  O#
GIVEN production at O2 is transport with 1 round remaining.

WHEN the game advances.

THEN O2 has a transport.
THEN T has mode awake.
THEN T has owner player.
THEN T does not have transport-mission.
THEN T does not have stuck-since-round.
THEN T does not have transport-id.

; Sentry armies adjacent to sentry transport board it.
GIVEN game map
  #A-
  -TA
  ---
T is sentry.
A1 is sentry.
A2 is sentry.
GIVEN player-items T.

WHEN player items are processed.

THEN T has army-count 2.
THEN no unit at A1 original position.
THEN no unit at A2 original position.

; Transport wakes at beach with armies aboard.
GIVEN game map
  ~~
  T~
  =#
  ~~
T is moving to the right with army-count 1 and target = and steps-remaining 1.

WHEN the game advances.

THEN T is at =.
THEN T has mode awake.
THEN T has reason transport-at-beach.

; Transport does not wake at beach without armies.
GIVEN game map
  ~~
  T~
  =#
  ~~
T is moving to the right with target = and steps-remaining 1.

WHEN the game advances.

THEN T is at =.
THEN T has mode awake.
THEN T does not have reason transport-at-beach.

; Wake armies command puts transport to sentry and wakes armies.
GIVEN game map
  --
  T#
  --
T is awake with army-count 2 and reason transport-at-beach.

WHEN the player presses u.

THEN T has mode sentry.
THEN T has army-count 2.
THEN T has awake-armies 2.
THEN T does not have reason.

; Disembarking army removes it from transport.
; Land % is to the right of transport.
GIVEN game map
  --
  T%
  --
T is sentry with army-count 3 and awake-armies 3.
GIVEN player-items T.

WHEN player items are processed.
WHEN the player presses d.

THEN T has army-count 2.
THEN T has awake-armies 2.
THEN there is an A at %.

; Transport wakes when last army disembarks.
; Land is to the right of transport.
GIVEN game map
  --
  T#
  --
T is sentry with army-count 1 and awake-armies 1.
GIVEN player-items T.

WHEN player items are processed.
WHEN the player presses d.

THEN T has mode awake.
THEN T has army-count 0.

; Transport finds land when moving from open sea.
GIVEN game map
  ~~~
  ~T~
  ~=~
  #~~
T is moving to the right with army-count 1 and target = and steps-remaining 1.

WHEN the game advances.

THEN T is at =.
THEN T has mode awake.
THEN T has reason transport-found-land.

; Transport wakes at first beach after going to open sea.
GIVEN game map
  #~
  ~T
  ~=
  ~#
T is moving to the right with army-count 1 and been-to-sea true and target = and steps-remaining 1.

WHEN the game advances.

THEN T is at =.
THEN T has mode awake.
THEN T has reason transport-at-beach.
THEN T has been-to-sea false.

; Transport with armies can attack city.
GIVEN game map
  ~T~
  #+#

Given T has army-count 1 and T is in sentry and armies are awake.

WHEN the army is told to move south into the city.

THEN combat ensues and if the army wins the city is captured, otherwise the army is destroyed.


