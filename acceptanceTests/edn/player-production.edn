{:source "player-production.txt", :tests [{:line 6, :description "Press a at city sets army production with 5 rounds remaining.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :a, :input-fn :handle-key}], :thens [{:type :production-with-rounds, :city "O", :expected :army, :remaining-rounds 5}]} {:line 17, :description "Press f at city sets fighter production with 10 rounds remaining.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :f, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :fighter, :remaining-rounds 10}]} {:line 28, :description "Press t at coastal city sets transport production.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :t, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :transport, :remaining-rounds 30}]} {:line 40, :description "Non-coastal city rejects ship production.", :givens [{:type :map, :target :game-map, :rows ["#O#" "###"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :t, :input-fn :key-down}], :thens [{:type :no-production, :city "O"} {:type :message-contains, :area :error, :config-key :coastal-city-required}]} {:line 53, :description "Press x cancels production.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true} {:type :production, :city "O", :item :army}], :whens [{:type :key-press, :key :x, :input-fn :handle-key}], :thens [{:type :no-production, :city "O"}]} {:line 65, :description "Press space skips city.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :space, :input-fn :key-down}], :thens [{:type :waiting-for-input, :expected false}]} {:line 76, :description "Army spawns when production completes.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :army, :remaining-rounds 1}], :whens [{:type :start-new-round}], :thens [{:type :unit-present, :unit "A", :coords [0 0]} {:type :unit-prop, :unit "A", :property :mode, :expected :awake} {:type :unit-prop, :unit "A", :property :owner, :expected :player}]} {:line 89, :description "Fighter spawns with fuel 32.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :fighter, :remaining-rounds 1}], :whens [{:type :start-new-round}], :thens [{:type :unit-present, :unit "F", :coords [0 0]} {:type :unit-prop, :unit "F", :property :fuel, :expected 32}]} {:line 101, :description "Satellite spawns with turns-remaining 50.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :satellite, :remaining-rounds 1}], :whens [{:type :start-new-round}], :thens [{:type :unit-present, :unit "V", :coords [0 0]} {:type :unit-prop, :unit "V", :property :turns-remaining, :expected 50}]} {:line 113, :description "Player production repeats after spawning.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :army, :remaining-rounds 1}], :whens [{:type :start-new-round}], :thens [{:type :unit-present, :unit "A", :coords [0 0]} {:type :production-with-rounds, :city "O", :expected :army, :remaining-rounds 5}]} {:line 125, :description "Unit not spawned if city occupied.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :army, :remaining-rounds 1} {:type :cell-props, :coords [0 0], :props {:contents :army}}], :whens [{:type :start-new-round}], :thens [{:type :production-with-rounds, :city "O", :expected :army, :remaining-rounds 1}]} {:line 137, :description "Army spawns with marching orders.", :givens [{:type :map, :target :game-map, :rows ["O###%"]} {:type :production, :city "O", :item :army, :remaining-rounds 1} {:type :cell-props, :coords [0 0], :props {:marching-orders [4 0]}}], :whens [{:type :start-new-round}], :thens [{:type :unit-prop, :unit "A", :property :mode, :expected :moving} {:type :unit-prop, :unit "A", :property :target, :expected [4 0]}]} {:line 150, :description "Army spawns in explore from lookaround.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :army, :remaining-rounds 1} {:type :cell-props, :coords [0 0], :props {:marching-orders :lookaround}}], :whens [{:type :start-new-round}], :thens [{:type :unit-prop, :unit "A", :property :mode, :expected :explore}]} {:line 162, :description "Fighter spawns with flight path.", :givens [{:type :map, :target :game-map, :rows ["O##########%"]} {:type :production, :city "O", :item :fighter, :remaining-rounds 1} {:type :cell-props, :coords [0 0], :props {:flight-path [11 0]}}], :whens [{:type :start-new-round}], :thens [{:type :unit-prop, :unit "F", :property :mode, :expected :moving} {:type :unit-prop, :unit "F", :property :target, :expected [11 0]}]} {:line 175, :description "Satellite costs 50 rounds.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :z, :input-fn :handle-key}], :thens [{:type :production-with-rounds, :city "O", :expected :satellite, :remaining-rounds 50}]} {:line 186, :description "Patrol-boat costs 15 rounds.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :p, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :patrol-boat, :remaining-rounds 15}]} {:line 198, :description "Destroyer costs 20 rounds.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :production-with-rounds, :city "O", :expected :destroyer, :remaining-rounds 20}]} {:line 210, :description "Submarine costs 20 rounds.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :submarine, :remaining-rounds 20}]} {:line 222, :description "Carrier costs 30 rounds.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :c, :input-fn :handle-key}], :thens [{:type :production-with-rounds, :city "O", :expected :carrier, :remaining-rounds 30}]} {:line 234, :description "Battleship costs 40 rounds.", :givens [{:type :map, :target :game-map, :rows ["~O" "~~"]} {:type :waiting-for-input, :unit "O", :set-mode true}], :whens [{:type :key-press, :key :b, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :battleship, :remaining-rounds 40}]} {:line 246, :description "Production countdown decrements each round.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :production, :city "O", :item :army, :remaining-rounds 3}], :whens [{:type :start-new-round}], :thens [{:type :production-with-rounds, :city "O", :expected :army, :remaining-rounds 2}]} {:line 257, :description "Changing production replaces previous production.", :givens [{:type :map, :target :game-map, :rows ["O#"]} {:type :waiting-for-input, :unit "O", :set-mode true} {:type :production, :city "O", :item :army}], :whens [{:type :key-press, :key :f, :input-fn :key-down}], :thens [{:type :production-with-rounds, :city "O", :expected :fighter, :remaining-rounds 10}]}]}