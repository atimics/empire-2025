{:source "battleship.txt", :tests [{:line 6, :description "Battleship moves 2 cells per round.", :givens [{:type :map, :target :game-map, :rows ["B~~="]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "B", :target "=", :at-next-round true}]} {:line 17, :description "Battleship put to sentry mode.", :givens [{:type :map, :target :game-map, :rows ["B~"]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "B", :property :mode, :expected :sentry}]} {:line 28, :description "Battleship attacks enemy submarine and wins.", :givens [{:type :map, :target :game-map, :rows ["Bs"]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :ship}], :thens [{:type :unit-occupies-cell, :unit "B", :target-unit "s", :at-next-round true} {:type :unit-absent, :unit "s"}]} {:line 39, :description "Battleship attacks enemy submarine and loses.", :givens [{:type :map, :target :game-map, :rows ["Bs"]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :lose, :combat-type :ship}], :thens [{:type :unit-unmoved, :unit "s", :at-next-round true} {:type :unit-absent, :unit "B"} {:type :message-contains, :area :turn, :text "Battleship destroyed"}]} {:line 52, :description "Battleship blocked by land.", :givens [{:type :map, :target :game-map, :rows ["B#"]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :ships-cant-drive-on-land, :at-next-step true}]} {:line 63, :description "Battleship blocked by friendly ship.", :givens [{:type :map, :target :game-map, :rows ["BS~"]} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :somethings-in-the-way, :at-next-step true}]} {:line 74, :description "Damaged battleship attention message.", :givens [{:type :map, :target :game-map, :rows ["B~"]} {:type :unit-props, :unit "B", :props {:hits 5}}], :whens [{:type :waiting-for-input, :unit "B", :set-mode true}], :thens [{:type :message-contains, :area :attention, :text "Damaged"}]} {:line 85, :description "Damaged battleship has reduced speed.", :givens [{:type :map, :target :game-map, :rows ["B~=~"]} {:type :unit-props, :unit "B", :props {:hits 5}} {:type :waiting-for-input, :unit "B", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "B", :target "=", :at-next-round true}]} {:line 97, :description "Sentry battleship wakes when enemy is adjacent.", :givens [{:type :map, :target :game-map, :rows ["Bs~"]} {:type :unit-props, :unit "B", :props {:mode :sentry}}], :whens [{:type :start-new-round} {:type :advance-until-waiting, :unit "B"}], :thens [{:type :unit-prop, :unit "B", :property :mode, :expected :awake} {:type :message-contains, :area :attention, :config-key :enemy-spotted}]}]}