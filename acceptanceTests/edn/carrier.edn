{:source "carrier.txt", :tests [{:line 6, :description "Wake fighters on carrier.", :givens [{:type :map, :target :game-map, :rows ["C~"]} {:type :unit-props, :unit "C", :props {:mode :sentry}} {:type :container-state, :target "C", :props {:fighter-count 2, :awake-fighters 0}}], :whens [{:type :waiting-for-input, :unit "C", :set-mode true} {:type :key-press, :key :u, :input-fn :key-down}], :thens [{:type :container-prop, :target "C", :property :awake-fighters, :expected 2, :lookup :unit} {:type :unit-prop, :unit "C", :property :mode, :expected :sentry}]} {:line 18, :description "Sleep fighters on carrier.", :givens [{:type :map, :target :game-map, :rows ["C~"]} {:type :unit-props, :unit "C", :props {:mode :sentry}} {:type :container-state, :target "C", :props {:awake-fighters 2}}], :whens [{:type :waiting-for-input, :unit "C", :set-mode true} {:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :container-prop, :target "C", :property :awake-fighters, :expected 0, :lookup :unit} {:type :unit-prop, :unit "C", :property :mode, :expected :awake}]} {:line 30, :description "Carrier with awake fighters needs attention.", :givens [{:type :map, :target :game-map, :rows ["C~"]} {:type :unit-props, :unit "C", :props {:mode :sentry}} {:type :container-state, :target "C", :props {:fighter-count 1, :awake-fighters 1}}], :whens [{:type :start-new-round} {:type :advance-until-waiting, :unit "C"}], :thens [{:type :message-contains, :area :attention, :text "carrier"}]} {:line 41, :description "Launch fighter from carrier.", :givens [{:type :map, :target :game-map, :rows ["C=~"]} {:type :unit-props, :unit "C", :props {:mode :sentry}} {:type :container-state, :target "C", :props {:awake-fighters 1}}], :whens [{:type :waiting-for-input, :unit "C", :set-mode true} {:type :key-press, :key :d, :input-fn :key-down}], :thens [{:type :unit-after-steps, :unit "F", :steps 1, :target "="} {:type :container-prop, :target "C", :property :fighter-count, :expected 0, :lookup :unit}]} {:line 53, :description "Carrier attention message shows fighter count.", :givens [{:type :map, :target :game-map, :rows ["C~"]} {:type :container-state, :target "C", :props {:fighter-count 3}}], :whens [{:type :waiting-for-input, :unit "C", :set-mode true}], :thens [{:type :message-contains, :area :attention, :text "carrier"} {:type :message-contains, :area :attention, :text "3 fighters"}]} {:line 64, :description "Damaged carrier attention message.", :givens [{:type :map, :target :game-map, :rows ["C~"]} {:type :unit-props, :unit "C", :props {:hits 5}} {:type :container-state, :target "C", :props {:fighter-count 0}}], :whens [{:type :waiting-for-input, :unit "C", :set-mode true}], :thens [{:type :message-contains, :area :attention, :text "Damaged"}]} {:line 75, :description "Carrier speed is 2 per round.", :givens [{:type :map, :target :game-map, :rows ["C~~=~"]} {:type :waiting-for-input, :unit "C", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "C", :target "=", :at-next-round true}]} {:line 86, :description "Carrier cannot move onto land.", :givens [{:type :map, :target :game-map, :rows ["C#"]} {:type :waiting-for-input, :unit "C", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :ships-cant-drive-on-land, :at-next-step true}]}]}