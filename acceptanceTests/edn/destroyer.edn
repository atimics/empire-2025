{:source "destroyer.txt", :tests [{:line 6, :description "Destroyer moves 2 cells in one round.", :givens [{:type :map, :target :game-map, :rows ["D~~="]} {:type :waiting-for-input, :unit "D", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "D", :target "=", :at-next-round true}]} {:line 17, :description "Destroyer attacks enemy ship and wins.", :givens [{:type :map, :target :game-map, :rows ["Ds"]} {:type :waiting-for-input, :unit "D", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :ship}], :thens [{:type :unit-occupies-cell, :unit "D", :target-unit "s", :at-next-round true} {:type :unit-absent, :unit "s"}]} {:line 28, :description "Destroyer attacks enemy ship and loses.", :givens [{:type :map, :target :game-map, :rows ["Ds"]} {:type :waiting-for-input, :unit "D", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :lose, :combat-type :ship}], :thens [{:type :unit-unmoved, :unit "s", :at-next-round true} {:type :unit-absent, :unit "D"} {:type :message-contains, :area :turn, :config-key :combat-result}]} {:line 41, :description "Destroyer put to sentry mode.", :givens [{:type :map, :target :game-map, :rows ["D~"]} {:type :waiting-for-input, :unit "D", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "D", :property :mode, :expected :sentry}]}]}