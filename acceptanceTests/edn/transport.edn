{:source "transport.txt", :tests [{:line 6, :description "Transport produced at player city is awake.", :givens [{:type :map, :target :game-map, :rows ["~O"]} {:type :production, :city "O", :item :transport, :remaining-rounds 1}], :whens [{:type :advance-game}], :thens [{:type :unit-prop, :unit "T", :property :mode, :expected :awake} {:type :unit-prop, :unit "T", :property :owner, :expected :player}]} {:line 18, :description "Transport does not have transport-mission after creation.", :givens [{:type :map, :target :game-map, :rows ["T~"]}], :whens [], :thens [{:type :unit-prop-absent, :unit "T", :property :transport-mission}]} {:line 26, :description "Wake armies command puts transport to sentry and wakes armies.", :givens [{:type :map, :target :game-map, :rows ["~~" "T#" "~~"]} {:type :unit-props, :unit "T", :props {:mode :awake, :army-count 2}} {:type :waiting-for-input, :unit "T", :set-mode false}], :whens [{:type :key-press, :key :u, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "T", :property :mode, :expected :sentry} {:type :unit-prop, :unit "T", :property :army-count, :expected 2}]} {:line 41, :description "Disembarking army removes it from transport.", :givens [{:type :map, :target :game-map, :rows ["~~" "T#" "~~"]} {:type :unit-props, :unit "T", :props {:mode :awake, :army-count 3}} {:type :waiting-for-input, :unit "T", :set-mode false}], :whens [{:type :key-press, :key :u, :input-fn :key-down} {:type :advance-until-waiting, :unit "T"} {:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-prop, :unit "T", :property :army-count, :expected 2} {:type :unit-present, :unit "A", :coords [1 1]}]} {:line 57, :description "Transport wakes when last army disembarks.", :givens [{:type :map, :target :game-map, :rows ["~~" "T#" "~~"]} {:type :unit-props, :unit "T", :props {:mode :awake, :army-count 1}} {:type :waiting-for-input, :unit "T", :set-mode false}], :whens [{:type :key-press, :key :u, :input-fn :key-down} {:type :advance-until-waiting, :unit "T"} {:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-prop, :unit "T", :property :mode, :expected :awake} {:type :unit-prop, :unit "T", :property :army-count, :expected 0}]} {:line 73, :description "Transport has 1 hit.", :givens [{:type :map, :target :game-map, :rows ["T~"]}], :whens [], :thens [{:type :unit-prop, :unit "T", :property :hits, :expected 1}]} {:line 81, :description "Transport moves 2 cells per round.", :givens [{:type :map, :target :game-map, :rows ["T~~="]} {:type :waiting-for-input, :unit "T", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "T", :target "=", :at-next-round true}]} {:line 92, :description "Transport blocked by land.", :givens [{:type :map, :target :game-map, :rows ["T#"]} {:type :waiting-for-input, :unit "T", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :ships-cant-drive-on-land, :at-next-step true}]} {:line 103, :description "Transport blocked by friendly ship.", :givens [{:type :map, :target :game-map, :rows ["TD~"]} {:type :waiting-for-input, :unit "T", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :somethings-in-the-way, :at-next-step true}]} {:line 114, :description "Transport sentry mode.", :givens [{:type :map, :target :game-map, :rows ["T~"]} {:type :waiting-for-input, :unit "T", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "T", :property :mode, :expected :sentry}]}]}