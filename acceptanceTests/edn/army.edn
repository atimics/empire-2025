{:source "army.txt", :tests [{:line 7, :description "Army put to sentry mode.", :givens [{:type :map, :target :game-map, :rows ["A#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "A", :property :mode, :expected :sentry}]} {:line 18, :description "Army set to explore mode.", :givens [{:type :map, :target :game-map, :rows ["A#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :l, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "A", :property :mode, :expected :explore}]} {:line 29, :description "Army wakes near hostile city with reason.", :givens [{:type :map, :target :game-map, :rows ["A#+"]} {:type :unit-target, :unit "A", :target "+"}], :whens [{:type :start-new-round}], :thens [{:type :unit-prop, :unit "A", :property :mode, :expected :awake} {:type :message-contains, :area :attention, :config-key :army-found-city}]} {:line 41, :description "Army conquers free city.", :givens [{:type :map, :target :game-map, :rows ["A+"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :army}], :thens [{:type :cell-prop, :coords [1 0], :property :city-status, :expected :player}]} {:line 52, :description "Army skips round with space.", :givens [{:type :map, :target :game-map, :rows ["A#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :space, :input-fn :key-down}], :thens [{:type :waiting-for-input, :expected false}]} {:line 63, :description "Army blocked by friendly city.", :givens [{:type :map, :target :game-map, :rows ["AO"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :cant-move-into-city, :at-next-step true}]}]}