{:source "unit-movement.txt", :tests [{:line 6, :description "Army moves northwest when player presses q.", :givens [{:type :map, :target :game-map, :rows ["%#" "#A"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :q, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 18, :description "Army moves north when player presses w.", :givens [{:type :map, :target :game-map, :rows ["#%" "#A"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :w, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 30, :description "Army moves northeast when player presses e.", :givens [{:type :map, :target :game-map, :rows ["#%" "A#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :e, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 42, :description "Army moves west when player presses a.", :givens [{:type :map, :target :game-map, :rows ["%A"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :a, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 53, :description "Army moves east when player presses d.", :givens [{:type :map, :target :game-map, :rows ["A%"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 64, :description "Army moves southwest when player presses z.", :givens [{:type :map, :target :game-map, :rows ["#A" "%#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :z, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 76, :description "Army moves south when player presses x.", :givens [{:type :map, :target :game-map, :rows ["A#" "%#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :x, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 88, :description "Army moves southeast when player presses c.", :givens [{:type :map, :target :game-map, :rows ["A#" "#%"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :c, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "A", :target "%", :at-next-step true}]} {:line 100, :description "Army extended move northwest.", :givens [{:type :map, :target :game-map, :rows ["%##" "###" "##A"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :Q, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 113, :description "Army extended move north.", :givens [{:type :map, :target :game-map, :rows ["#%#" "###" "#A#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :W, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 126, :description "Army extended move northeast.", :givens [{:type :map, :target :game-map, :rows ["##%" "###" "A##"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :E, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 139, :description "Army extended move west.", :givens [{:type :map, :target :game-map, :rows ["%##A"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :A, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 150, :description "Army extended move east.", :givens [{:type :map, :target :game-map, :rows ["A##%"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 161, :description "Army extended move southwest.", :givens [{:type :map, :target :game-map, :rows ["##A" "###" "%##"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :Z, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 174, :description "Army extended move south.", :givens [{:type :map, :target :game-map, :rows ["#A#" "###" "#%#"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :X, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 187, :description "Army extended move southeast.", :givens [{:type :map, :target :game-map, :rows ["A##" "###" "##%"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :C, :input-fn :key-down}], :thens [{:type :unit-eventually-at, :unit "A", :target "%"}]} {:line 200, :description "Destroyer moves east on sea.", :givens [{:type :map, :target :game-map, :rows ["D="]} {:type :waiting-for-input, :unit "D", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "D", :target "=", :at-next-step true}]} {:line 211, :description "Fighter moves east over sea.", :givens [{:type :map, :target :game-map, :rows ["F="]} {:type :waiting-for-input, :unit "F", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "F", :target "=", :at-next-step true}]} {:line 222, :description "Fighter moves east over land.", :givens [{:type :map, :target :game-map, :rows ["F%"]} {:type :waiting-for-input, :unit "F", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :unit-at-next-round, :unit "F", :target "%", :at-next-step true}]} {:line 233, :description "Army cannot move onto sea.", :givens [{:type :map, :target :game-map, :rows ["A~"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :cant-move-into-water, :at-next-step true}]} {:line 244, :description "Army conquers computer city when conquest succeeds.", :givens [{:type :map, :target :game-map, :rows ["AX"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :army}], :thens [{:type :unit-absent, :unit "A"} {:type :cell-prop, :coords [1 0], :property :city-status, :expected :player}]} {:line 256, :description "Army destroyed when conquest fails.", :givens [{:type :map, :target :game-map, :rows ["AX"]} {:type :waiting-for-input, :unit "A", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :lose, :combat-type :army}], :thens [{:type :unit-absent, :unit "A"} {:type :cell-prop, :coords [1 0], :property :city-status, :expected :computer}]} {:line 268, :description "Fighter shot down over computer city.", :givens [{:type :map, :target :game-map, :rows ["FX"]} {:type :waiting-for-input, :unit "F", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :error, :text "Fighter destroyed", :at-next-step true}]}]}