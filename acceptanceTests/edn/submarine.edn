{:source "submarine.txt", :tests [{:line 6, :description "Submarine has 2 hits.", :givens [{:type :map, :target :game-map, :rows ["S~"]}], :whens [], :thens [{:type :unit-prop, :unit "S", :property :hits, :expected 2}]} {:line 14, :description "Submarine moves on sea only.", :givens [{:type :map, :target :game-map, :rows ["S#"]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :ships-cant-drive-on-land, :at-next-step true}]} {:line 25, :description "Submarine attacks destroyer and wins.", :givens [{:type :map, :target :game-map, :rows ["Sd"]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :win, :combat-type :ship}], :thens [{:type :unit-occupies-cell, :unit "S", :target-unit "d", :at-next-round true} {:type :unit-absent, :unit "d"}]} {:line 36, :description "Submarine put to sentry mode.", :givens [{:type :map, :target :game-map, :rows ["S~"]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :key-press, :key :s, :input-fn :key-down}], :thens [{:type :unit-prop, :unit "S", :property :mode, :expected :sentry}]} {:line 47, :description "Submarine moves 2 cells per round.", :givens [{:type :map, :target :game-map, :rows ["S~~="]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :key-press, :key :D, :input-fn :key-down}], :thens [{:type :unit-at-next-round, :unit "S", :target "=", :at-next-round true}]} {:line 58, :description "Submarine attacks enemy and loses.", :givens [{:type :map, :target :game-map, :rows ["Sd"]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :battle, :key :d, :outcome :lose, :combat-type :ship}], :thens [{:type :unit-unmoved, :unit "d", :at-next-round true} {:type :unit-absent, :unit "S"} {:type :message-contains, :area :turn, :text "Submarine destroyed"}]} {:line 71, :description "Submarine blocked by friendly ship.", :givens [{:type :map, :target :game-map, :rows ["SD~"]} {:type :waiting-for-input, :unit "S", :set-mode true}], :whens [{:type :key-press, :key :d, :input-fn :handle-key}], :thens [{:type :message-contains, :area :attention, :config-key :somethings-in-the-way, :at-next-step true}]} {:line 82, :description "Sentry submarine wakes when enemy is adjacent.", :givens [{:type :map, :target :game-map, :rows ["Sd~"]} {:type :unit-props, :unit "S", :props {:mode :sentry}}], :whens [{:type :start-new-round} {:type :advance-until-waiting, :unit "S"}], :thens [{:type :unit-prop, :unit "S", :property :mode, :expected :awake} {:type :message-contains, :area :attention, :config-key :enemy-spotted}]}]}